name: build

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Run build with Gradle wrapper
        run: ./gradlew assembleRelease

      - name: Sign app APK
        id: sign_app
        uses: r0adkll/sign-android-release@v1
        with:
          releaseDirectory: app/build/outputs/apk/release
          alias: '1151'
          signingKeyBase64: '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'
          keyStorePassword: 'OX5KmP656MmzNX4'
          keyPassword: 'OX5KmP656MmzNX4'
        env:
          # override default build-tools version (29.0.3) -- optional
          BUILD_TOOLS_VERSION: "34.0.0"

      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          draft: false
          prerelease: false

      - name: Upload Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ${{ steps.sign_app.outputs.signedReleaseFile }}
          asset_name: my-tv-0-${{ github.ref_name }}.apk
          asset_content_type: application/vnd.android.package-archive
